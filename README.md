# Vulnerability Example

The different between `no-vulnerability.sol` & `with-vulnerability.sol` is in function `withdrawCoins`

## The problem
     The code `wallet.payout.value(withdrawAmount)();`
     Is calling a function define outside the own contract.
     Therefore user may doing duty thing in it.

## Correct
```
    function withdrawCoins(){
        uint withdrawAmount = balances[msg.sender];
        balances[msg.sender] = 0;
        Wallet wallet = Wallet(msg.sender);
        wallet.payout.value(withdrawAmount)();
    }
```

## Incorrect
```
    function withdrawCoins(){
        uint withdrawAmount = balances[msg.sender];
        Wallet wallet = Wallet(msg.sender);
        wallet.payout.value(withdrawAmount)();
        balances[msg.sender] = 0;
    }
```

### To run this example
1. go to `https://remix.ethereum.org`
1. choose the correct version of compiler
1. Run in `Javascript VM` environment
1. Deploy contract `Fundraiser` first
1. Copy the address of `Fundraiser contract` you just deployed
1. Deploy contract `Wallet` with the copied contract address
1. Call `fallback` function with `value` in both contract to make some dummy balance for testing
1. Call `Fundraiser.getBalance` & `Wallet.getBalance`, both balance should > 0
1. Call `Wallet.contribute`
1. Call `Fundraiser.getBalance` & `Wallet.getBalance`, double check the balance
1. Call `Wallet.withdraw`


ps: you can check the `debug event log` in each transactions
